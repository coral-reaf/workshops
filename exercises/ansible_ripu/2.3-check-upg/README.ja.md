# ワークショップ演習 - アップグレードが機能したかどうかの確認

## 目次

- [ワークショップ演習 - アップグレードが機能したかどうかの確認](#workshop-exercise---check-if-the-upgrades-worked)
  - [目次](#目次)
  - [目標](#目標)
  - [ガイド](#ガイド)
    - [Step 1 - アップグレード Playbook のジョブログを確認する](#step-1---アップグレード-playbook-のジョブログを確認する)
    - [Step 2 - ホストが次の RHEL バージョンにアップグレードされたことを確認する](#step-2---ホストが次の-rhel-バージョンにアップグレードされたことを確認する)
  - [結論](#結論)

## 目的

* アップグレード Playbook のジョブログを確認する
* ペットアプリケーションサーバーが新しい RHEL バージョンを実行していることを確認する

## ガイド

前の演習では、アップグレード前のレポートを確認し、推奨される修復をいくつか実行しました。オプションの演習を試した場合は、カスタムのアップグレード前チェックについても学習し、サンプルのペット アプリケーションをインストールしました。そのすべてが終わったら、最後に Ansible プレイブック ジョブを起動して、サーバー上で RHEL インプレース アップグレードを実行しました。

アップグレードの結果を確認し、アプリケーション チームがペット アプリがまだ正常かどうかを評価できるようにします。ここでは、RHEL インプレース アップグレード自動化ワークフローについて説明します。

![アプリ検証手順が強調表示された自動化アプローチ ワークフロー図](images/ripu-workflow-hl-validate.svg)

始めましょう!

### Step 1 - アップグレード Playbook のジョブログを確認する

最初に、アップグレード プレイブックを実行するジョブが正常に終了したかどうかを確認します。

- Web ブラウザーで AAP Web UI タブに戻ります。[Views] > [Jobs] に移動し、[OS / Upgrade] プレイブック実行エントリを開いて、アップグレードからのログ出力を確認します。

> **注意**
>
> 「AUTO / 02 アップグレード」ワークフロー ジョブのエントリも表示されます。ワークフロー ジョブは、複数のプレイブック実行を開始します。プレイブックのログ出力を表示するには、ワークフロー ジョブ エントリではなく、プレイブック実行エントリを開く必要があります。

例:

![AAP Web UI のアップグレード ジョブ エントリ一覧](images/upgrade_jobs.svg)

- プレイブック実行が失敗したタスクなしで終了した場合は、緑色のチェックマークとともに「成功」​​が表示されます。

> **注意**
>
> 回転矢印とともに「実行中」と表示される場合は、プレイブックはまだ実行中です。プレイブックの実行が完了するまで待ってから、この演習を続行してください。

ログ出力の最後までスクロールすると、「PLAY RECAP」が表示され、各ホストで実行されたプレイブック実行の成功または失敗のステータスが表示されます。表示される内容は次のとおりです。

![アップグレード プレイブックの実行と再生の要約が成功したことを示す AAP Web UI](images/upgrade_play_recap.svg)

実行に失敗がない場合、すべてのペット アプリケーション サーバーで RHEL インプレース アップグレードが実行されます。

### Step 2 - ホストが次の RHEL バージョンにアップグレードされたことを確認する

次に、ペット アプリケーション サーバーが実際に次の RHEL バージョンにアップグレードされていることを確認します。

- [演習 1.3: Step 2](../1.3-report/README.ja.md#step-2---rhel-web-コンソールの操作) では、RHEL Web コンソールを使用して、ペット アプリケーション サーバーにインストールされている RHEL バージョンを確認しました。これらの手順を繰り返して、アップグレード後に報告された RHEL バージョンを確認しましょう。

RHEL Web コンソールのブラウザー タブに戻り、リモート ホスト メニューを使用して、各ペット アプリケーション サーバーの Web コンソールに移動します。 RHEL Web コンソールのシステム概要ページに、アップグレードされたバージョンが表示されるはずです。

> **注意**
>
> 新しく報告された RHEL バージョンを確認するには、Ctrl + R を使用してブラウザを更新する必要がある場合があります。

たとえば、以前は RHEL8 だったこのペット アプリ サーバーは、現在 RHEL9 を報告しています:

![fluent-bee は Red Hat Enterprise Linux 9.2 (Plow) を実行しています](images/rhel9_upgraded.svg)

以前は RHEL7 だったが、現在は RHEL8 を実行している例を次に示します:

![vocal-hyena は Red Hat Enterprise Linux Server 8.8 (Oopta) を実行しています](images/rhel8_upgraded.svg)

- [演習 1.1: 手順 2](../1.1-setup/README.ja.md#step-2---ターミナルセッションを開く) で使用した手順に従って、コマンド ラインから RHEL およびカーネルのバージョンを確認することもできます。

ペット アプリ サーバーのシェル プロンプトで、`cat /etc/redhat-release` コマンドと `uname -r` コマンドを使用します。RHEL9 にアップグレードされたペット アプリ サーバーの例を次に示します。

![RHEL9 がインストールされたことを示すコマンド出力](images/rhel9_commands.svg)

## まとめ

この演習では、アップグレード プレイブックの実行が正常に完了したことを確認しました。次に、RHEL Web コンソールとコマンド ラインを使用して、新しい RHEL バージョンがインストールされたことを確認しました。

前のオプション演習でサンプル ペット アプリケーションをデプロイした場合は、ここで続行して、RHEL アップグレード後もペット アプリケーションが期待どおりに機能していることを確認します。

- [演習 2.4 - ペットアプリケーションの状態は?](../2.4-check-pet-app/README.ja.md)

それ以外の場合は、ワークショップの次のセクションに進んでください。次の演習から始めて、RHEL アップグレードのロールバックを実演します。

- [演習 3.1 - (オプション) インスタンスを破棄する](../3.1-rm-rf/README.ja.md)
- [演習 3.2 - ロールバック ジョブを実行する](../3.2-rollback/README.ja.md)

---

**Navigation**

[Previous Exercise](../2.1-upgrade/README.ja.md) - [Next Exercise](../2.4-check-pet-app/README.ja.md)

[Home](../README.ja.md)

**Navigation**

[Previous Exercise](../2.1-upgrade/README.md) - [Next Exercise](../2.4-check-pet-app/README.md)

[Home](../README.md)
